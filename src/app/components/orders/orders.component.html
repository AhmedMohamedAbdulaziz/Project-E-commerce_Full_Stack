<div class="orders-container">
  <div class="orders-header">
    <h1>My Orders</h1>
    <p>Track your order history and status</p>
  </div>

  @if (loading) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading your orders...</p>
  </div>
  } @else if (error) {
  <div class="error-message">
    {{ error }}
    <button class="btn-retry" (click)="loadOrders()">Try Again</button>
  </div>
  } @else if (orders.length === 0) {
  <div class="empty-orders">
    <div class="empty-orders-content">
      <div class="empty-orders-icon">ðŸ“¦</div>
      <h2>No orders yet</h2>
      <p>
        You haven't placed any orders yet. Start shopping to see your order
        history here.
      </p>
      <button class="btn-primary" (click)="goToProducts()">
        Start Shopping
      </button>
    </div>
  </div>
  } @else {
  <div class="orders-list">
    @for (order of orders; track $index) {
    <div class="order-card" [class.expanded]="selectedOrder?._id === order._id">
      <div class="order-header" (click)="selectOrder(order)">
        <div class="order-info">
          <div class="order-number">
            <strong>Order #{{ order.orderNumber }}</strong>
          </div>
          <div class="order-date">
            {{ formatDate(order.createdAt || "") }}
          </div>
        </div>
        <div class="order-status">
          <span
            class="status-badge"
            [style.background-color]="getStatusColor(order.status)"
          >
            {{ getStatusText(order.status) }}
          </span>
        </div>
        <div class="order-total">
          <strong>{{ order.totalPrice | currency : "EGP " }}</strong>
        </div>
        <div class="expand-icon">
          {{ selectedOrder?._id === order._id ? "âˆ’" : "+" }}
        </div>
      </div>

      @if (selectedOrder?._id === order._id) {
      <div class="order-details">
        <div class="details-section">
          <h3>Order Items</h3>
          <div class="order-items">
            @for (item of order.items; track item._id) {
            <div class="order-item">
              <div class="item-info">
                <div class="item-details">
                  <span class="item-name">{{
                    typeof item.product === 'object' ? item.product.name : "Product ID: " + item.product
                  }}</span>
                  <span class="item-quantity">Qty: {{ item.quantity }}</span>
                </div>
                <div class="item-price">
                  @if (typeof item.product === 'object' && item.product.price) {
                  {{ item.product.price | currency : "EGP " }}
                  } @else { Price not available }
                </div>
              </div>
            </div>
            }
          </div>
        </div>

        <div class="details-section">
          <h3>Shipping Information</h3>
          <div class="shipping-info">
            <p><strong>Address:</strong> {{ order.shippingAddress.street }}</p>
            <p><strong>City:</strong> {{ order.shippingAddress.city }}</p>
            <p><strong>Country:</strong> {{ order.shippingAddress.country }}</p>
            <p>
              <strong>Phone:</strong> {{ order.shippingAddress.phoneNumber }}
            </p>
          </div>
        </div>

        @if (order.notes) {
        <div class="details-section">
          <h3>Order Notes</h3>
          <p class="order-notes">{{ order.notes }}</p>
        </div>
        }

        <div class="details-section">
          <h3>Order Summary</h3>
          <div class="order-summary">
            <div class="summary-row">
              <span>Items Price:</span>
              <span>{{ order.itemsPrice | currency : "EGP " }}</span>
            </div>
            <div class="summary-row">
              <span>Shipping Cost:</span>
              <span>{{ order.shippingCost | currency : "EGP " }}</span>
            </div>
            <div class="summary-row total">
              <span>Total:</span>
              <span>{{ order.totalPrice | currency : "EGP " }}</span>
            </div>
          </div>
        </div>

        <div class="details-section">
          <h3>Order Timeline</h3>
          <div class="order-timeline">
            <div class="timeline-item">
              <div class="timeline-date">
                {{ formatDate(order.createdAt || "") }}
              </div>
              <div class="timeline-content">
                <strong>Order Placed</strong>
                <p>Your order has been successfully placed</p>
              </div>
            </div>
            @if (order.status !== 'pending') {
            <div class="timeline-item">
              <div class="timeline-date">
                {{ formatDate(order.updatedAt || "") }}
              </div>
              <div class="timeline-content">
                <strong>Order {{ getStatusText(order.status) }}</strong>
                <p>Your order is now {{ order.status }}</p>
              </div>
            </div>
            }
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>
  }
</div>
